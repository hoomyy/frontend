<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <!-- ===========================================
         SECURITY HEADERS
         =========================================== -->
    
    <!-- Content Security Policy - Strict -->
    <!-- Note: frame-ancestors must be set via HTTP header, not meta tag -->
    <!-- In development, CSP is relaxed to allow Vite HMR and module loading -->
    <!-- Production CSP should be stricter - remove 'unsafe-inline' and 'unsafe-eval' when possible -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' http://localhost:* ws://localhost:*; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: blob: https://images.unsplash.com https://backend.hoomy.site https://*.stripe.com; connect-src 'self' http://localhost:* https://localhost:* https://backend.hoomy.site https://api.stripe.com https://fonts.googleapis.com ws://localhost:*; frame-src 'self' https://js.stripe.com https://hooks.stripe.com; form-action 'self'; base-uri 'self'; object-src 'none'; media-src 'self' blob: data:; worker-src 'self' blob:; manifest-src 'self'; upgrade-insecure-requests; block-all-mixed-content;" />
    
    <!-- X-Content-Type-Options -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff" />
    
    <!-- Note: X-Frame-Options must be set via HTTP header, not meta tag -->
    <!-- The server should send: X-Frame-Options: DENY -->
    
    <!-- Referrer Policy - Limit information leakage -->
    <meta name="referrer" content="strict-origin-when-cross-origin" />
    
    <!-- Permissions Policy - Disable unnecessary features -->
    <meta http-equiv="Permissions-Policy" content="
      accelerometer=(),
      ambient-light-sensor=(),
      autoplay=(),
      battery=(),
      camera=(),
      display-capture=(),
      document-domain=(),
      encrypted-media=(),
      fullscreen=(self),
      geolocation=(),
      gyroscope=(),
      magnetometer=(),
      microphone=(),
      midi=(),
      payment=(self https://js.stripe.com),
      picture-in-picture=(),
      publickey-credentials-get=(),
      screen-wake-lock=(),
      sync-xhr=(),
      usb=(),
      web-share=(),
      xr-spatial-tracking=()
    " />
    
    <!-- ===========================================
         PWA / MOBILE
         =========================================== -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Hoomy" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <link rel="manifest" href="/manifest.json" />
    
    <!-- ===========================================
         PRECONNECT & DNS PREFETCH
         =========================================== -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://backend.hoomy.site" crossorigin />
    <link rel="dns-prefetch" href="https://images.unsplash.com" />
    <link rel="dns-prefetch" href="https://js.stripe.com" />
    
    <!-- Preload only logo (small, critical) -->
    <link rel="preload" href="/logo.svg" as="image" type="image/svg+xml" />
    <!-- Don't preload videos - too heavy, especially on mobile -->
    
    <!-- ===========================================
         FAVICONS
         =========================================== -->
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="alternate icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    
    <!-- ===========================================
         FONTS (async loading with font-display swap)
         =========================================== -->
    <!-- Preconnect to Google Fonts for faster font loading -->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'" />
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" /></noscript>
    
    <!-- ===========================================
         CRITICAL CSS
         =========================================== -->
    <style>
      *{box-sizing:border-box;margin:0;padding:0}
      html{font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;line-height:1.5;-webkit-text-size-adjust:100%;text-size-adjust:100%}
      body{min-height:100vh;background:#fff}
      #root{min-height:100vh;width:100%;display:flex;flex-direction:column}
      body:not(.loaded){opacity:0}
      body.loaded{opacity:1;transition:opacity .05s ease-out}
      .skeleton{background:linear-gradient(90deg,#f3f4f6 25%,#e5e7eb 50%,#f3f4f6 75%);background-size:200% 100%;animation:skeleton 1.2s ease-in-out infinite}
      @keyframes skeleton{0%{background-position:200% 0}100%{background-position:-200% 0}}
      .initial-loader{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#fff;z-index:9999}
      .initial-loader.hidden{opacity:0;pointer-events:none;transition:opacity .3s}
      .loader-logo{width:80px;height:80px;margin-bottom:24px;animation:pulse 2s ease-in-out infinite}
      .loader-spinner{width:40px;height:40px;border:3px solid #e5e7eb;border-top-color:#2563eb;border-radius:50%;animation:spin .8s linear infinite}
      @keyframes spin{to{transform:rotate(360deg)}}
      @keyframes pulse{0%,100%{opacity:1;transform:scale(1)}50%{opacity:0.7;transform:scale(0.95)}}
      img,video{max-width:100%;height:auto;display:block}
      button{cursor:pointer}
    </style>
    
    <!-- ===========================================
         SEO
         =========================================== -->
    <title>Hoomy - Logement étudiant en Suisse | Zurich, Genève, Lausanne</title>
    <meta name="description" content="Trouvez votre logement étudiant idéal en Suisse. Parcourez des propriétés vérifiées à Zurich, Genève, Lausanne, Berne et plus. Locations sécurisées avec des propriétaires de confiance." />
    <meta name="keywords" content="logement étudiant, Suisse, Zurich, Genève, Lausanne, Berne, Bâle, Lugano, location appartement, colocation, studio étudiant, logement universitaire, appartement étudiant, location Suisse, hébergement étudiant" />
    <meta name="author" content="Hoomy" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="googlebot" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="bingbot" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <link rel="canonical" href="https://hoomy.site/" />
    <link rel="sitemap" type="application/xml" href="/sitemap.xml" />
    
    <!-- Hreflang pour internationalisation - Toutes les langues supportées -->
    <link rel="alternate" hreflang="fr" href="https://hoomy.site/" />
    <link rel="alternate" hreflang="fr-CH" href="https://hoomy.site/" />
    <link rel="alternate" hreflang="en" href="https://hoomy.site/?lang=en" />
    <link rel="alternate" hreflang="it" href="https://hoomy.site/?lang=it" />
    <link rel="alternate" hreflang="de-CH" href="https://hoomy.site/?lang=de-ch" />
    <link rel="alternate" hreflang="de" href="https://hoomy.site/?lang=de-ch" />
    <link rel="alternate" hreflang="x-default" href="https://hoomy.site/" />
    
    <!-- Géolocalisation -->
    <meta name="geo.region" content="CH" />
    <meta name="geo.placename" content="Suisse" />
    <meta name="ICBM" content="46.8182, 8.2275" />
    
    <!-- Métadonnées supplémentaires -->
    <meta name="language" content="French" />
    <meta name="revisit-after" content="1 days" />
    <meta name="distribution" content="global" />
    <meta name="rating" content="general" />
    <meta name="coverage" content="worldwide" />
    <meta name="target" content="all" />
    <meta name="audience" content="students, university students, property owners" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://hoomy.site/" />
    <meta property="og:title" content="Hoomy - Logement étudiant en Suisse | Zurich, Genève, Lausanne" />
    <meta property="og:description" content="Trouvez votre logement étudiant idéal en Suisse. Parcourez des propriétés vérifiées à Zurich, Genève, Lausanne, Berne et plus. Locations sécurisées avec des propriétaires de confiance." />
    <meta property="og:image" content="https://hoomy.site/images/zurich.webp" />
    <meta property="og:image:secure_url" content="https://hoomy.site/images/zurich.webp" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="Hoomy - Logement étudiant en Suisse" />
    <meta property="og:image:type" content="image/webp" />
    <meta property="og:locale" content="fr_CH" />
    <meta property="og:locale:alternate" content="de_CH" />
    <meta property="og:site_name" content="Hoomy" />
    <meta property="og:determiner" content="the" />
    <meta property="article:author" content="Hoomy" />
    <meta property="article:publisher" content="https://hoomy.site" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://hoomy.site/" />
    <meta name="twitter:title" content="Hoomy - Logement étudiant en Suisse | Zurich, Genève, Lausanne" />
    <meta name="twitter:description" content="Trouvez votre logement étudiant idéal en Suisse. Parcourez des propriétés vérifiées à Zurich, Genève, Lausanne, Berne et plus." />
    <meta name="twitter:image" content="https://hoomy.site/images/zurich.webp" />
    <meta name="twitter:image:alt" content="Hoomy - Logement étudiant en Suisse" />
    <meta name="twitter:site" content="@hoomy" />
    <meta name="twitter:creator" content="@hoomy" />
    <meta name="twitter:domain" content="hoomy.site" />
    
    <!-- Theme color for browsers -->
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)" />
    <meta name="theme-color" content="#0a0a0a" media="(prefers-color-scheme: dark)" />
    <meta name="msapplication-TileColor" content="#2563eb" />
    
    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Hoomy",
      "description": "Plateforme de logement étudiant en Suisse",
      "url": "https://hoomy.site",
      "logo": "https://hoomy.site/logo.svg",
      "image": "https://hoomy.site/logo.svg",
      "applicationCategory": "Real Estate",
      "operatingSystem": "Web",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "CHF"
      },
      "areaServed": {
        "@type": "Country",
        "name": "Switzerland"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Hoomy",
      "legalName": "Hoomy",
      "url": "https://hoomy.site",
      "logo": {
        "@type": "ImageObject",
        "url": "https://hoomy.site/logo.svg",
        "width": 500,
        "height": 500
      },
      "image": "https://hoomy.site/logo.svg",
      "description": "Plateforme de logement étudiant en Suisse. Trouvez votre logement étudiant idéal à Zurich, Genève, Lausanne, Berne et plus.",
      "foundingDate": "2025",
      "foundingLocation": {
        "@type": "Place",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "CH"
        }
      },
      "areaServed": {
        "@type": "Country",
        "name": "Switzerland"
      },
      "knowsAbout": [
        "Logement étudiant",
        "Location immobilière",
        "Colocation",
        "Appartement étudiant",
        "Immobilier Suisse"
      ],
      "sameAs": []
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Hoomy",
      "alternateName": "Hoomy - Logement étudiant en Suisse",
      "url": "https://hoomy.site",
      "logo": {
        "@type": "ImageObject",
        "url": "https://hoomy.site/logo.svg",
        "width": 500,
        "height": 500
      },
      "description": "Trouvez votre logement étudiant idéal en Suisse. Parcourez des propriétés vérifiées à Zurich, Genève, Lausanne, Berne et plus.",
      "inLanguage": ["fr", "fr-CH", "en", "it", "de-CH", "de"],
      "potentialAction": {
        "@type": "SearchAction",
        "target": {
          "@type": "EntryPoint",
          "urlTemplate": "https://hoomy.site/properties?search={search_term_string}"
        },
        "query-input": "required name=search_term_string"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Hoomy",
        "logo": {
          "@type": "ImageObject",
          "url": "https://hoomy.site/logo.svg"
        }
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "RealEstateAgent",
      "name": "Hoomy",
      "url": "https://hoomy.site",
      "logo": "https://hoomy.site/logo.svg",
      "description": "Plateforme de logement étudiant en Suisse",
      "areaServed": {
        "@type": "Country",
        "name": "Switzerland"
      },
      "serviceType": "Student Housing Rental",
      "priceRange": "$$"
    }
    </script>
  </head>
  <body>
    <!-- Security: Prevent clickjacking via JS (backup to X-Frame-Options) -->
    <script>
      if (self !== top) {
        document.body.innerHTML = '';
        top.location = self.location;
      }
    </script>
    
    <!-- Initial loader with logo (removed by JS) -->
    <div id="initial-loader" class="initial-loader" aria-hidden="true">
      <img src="/logo.svg" alt="Hoomy" class="loader-logo" />
      <div class="loader-spinner"></div>
      <div class="loader-progress" style="margin-top: 16px; color: #6b7280; font-size: 14px; font-weight: 500;">0%</div>
    </div>
    
    <div id="root"></div>
    
    <script>
      // App version for cache busting - always fresh
      window.APP_VERSION = 'v9-' + Date.now();
      
      // DISABLE ALL CACHE - clear everything on load
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function(registrations) {
          for(let registration of registrations) {
            registration.unregister();
          }
        });
      }
      if ('caches' in window) {
        caches.keys().then(function(names) {
          return Promise.all(names.map(function(name) {
            return caches.delete(name);
          }));
        });
      }
      
      // CRITICAL: Clear stale caches and service workers on load errors
      (function() {
        var loader = document.getElementById('initial-loader');
        var hasError = false;
        
        function hideLoader() {
          document.body.classList.add('loaded');
          if (loader) {
            loader.classList.add('hidden');
            setTimeout(function() { loader.remove(); }, 300);
          }
        }
        
        window.__hideLoader = hideLoader;
        
        // Clear ALL caches and service workers IMMEDIATELY on every load
        function clearAllCaches() {
          // Clear service worker caches immediately
          if ('caches' in window) {
            caches.keys().then(function(names) {
              return Promise.all(names.map(function(name) {
                return caches.delete(name);
              }));
            }).catch(function() {
              // Ignore errors
            });
          }
          
          // Unregister all service workers immediately
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
              return Promise.all(registrations.map(function(reg) {
                return reg.unregister();
              }));
            }).catch(function() {
              // Ignore errors
            });
          }
        }
        
        // Clear caches immediately on every page load
        clearAllCaches();
        
        // DISABLED: Auto-reload on errors causes infinite loops
        // Just log errors, don't reload
        function handleLoadError(error) {
          var errorMsg = error && error.message ? error.message : String(error);
          console.error('[Hoomy] Load error detected (auto-reload disabled):', errorMsg);
          console.log('[Hoomy] Please manually refresh if needed');
          
          // Just hide loader and show error message, don't reload
          hideLoader();
          var root = document.getElementById('root');
          if (root && !root.innerHTML.trim()) {
            root.innerHTML = 
              '<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:20px;text-align:center;font-family:Inter,system-ui,sans-serif">' +
              '<h1 style="margin-bottom:16px;color:#1f2937">Erreur de chargement</h1>' +
              '<p style="color:#6b7280;margin-bottom:24px">Le site n\'a pas pu charger correctement.</p>' +
              '<p style="color:#6b7280;margin-bottom:24px;font-size:14px">Veuillez recharger manuellement la page (F5).</p>' +
              '<button onclick="window.location.reload()" ' +
              'style="background:#2563eb;color:white;padding:12px 24px;border:none;border-radius:8px;cursor:pointer;font-size:16px">' +
              'Recharger la page manuellement</button></div>';
          }
        }
        
        // Listen for script loading errors - just log, don't reload
        window.addEventListener('error', function(event) {
          if (event.target && (event.target.tagName === 'SCRIPT' || event.target.tagName === 'LINK')) {
            console.error('[Hoomy] Resource load error:', event.target.src || event.target.href);
            // Don't call handleLoadError - it would show error but won't reload
          }
        }, true);
        
        // Listen for unhandled promise rejections - just log, don't reload
        window.addEventListener('unhandledrejection', function(event) {
          if (event.reason && event.reason.message && 
              (event.reason.message.includes('Failed to fetch dynamically imported module') ||
               event.reason.message.includes('Loading chunk') ||
               event.reason.message.includes('Loading module'))) {
            console.error('[Hoomy] Module loading error (auto-reload disabled):', event.reason.message);
            console.log('[Hoomy] Please manually refresh if needed');
            // Don't call handleLoadError - it would show error but won't reload
          }
        });
        
        // Hide loader on successful load
        if (document.readyState === 'complete') {
          setTimeout(hideLoader, 100);
        } else {
          window.addEventListener('load', function() {
            setTimeout(hideLoader, 100);
          });
        }
        
        // Fallback: hide immediately (no delay)
        setTimeout(hideLoader, 50);
      })();
    </script>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
